% arara: pdflatex
% !arara: bibtex
% !arara: pdflatex
% !arara: pdflatex
% !arara: makeglossaries
% !arara: pdflatex
\documentclass[11pt,twoside]{report}
%= == == == == == == == == == == =
%
% Document details: Program review for the mathematics department
%       at Portland Community College, Portland OR
%
%       Prepared in Fall 2013
%
%= == == == == == == == == == == =
\usepackage[left=3.5cm,right=2.0cm,showframe=false,
top=2cm,bottom=1.5cm,asymmetric=true,bindingoffset=1cm]{geometry}               
\usepackage{parskip}
\usepackage{titlesec}                   % customize headings
\usepackage{titletoc}                   % customize tableofcontents
\usepackage{multirow}                   % multirows in tables
\usepackage{booktabs}                   % beautiful tables
\usepackage{flafter}                    % floats won't appear until after they appear in the code
\usepackage[figuresright]{rotating}     % sideways table
\usepackage{longtable}                  % tables that can break across pages
\usepackage{fancyhdr}                   % headers and footers
\usepackage{standalone}                 % maintain graphs and tables in separate files
\usepackage{pdfpages}                   % include separate pdf documents
\usepackage{enumitem}                   % customization of list environments
\usepackage{titlepic}                   % image for titlepage
\usepackage{changepage}                 % adjust margins for selected portions
\usepackage{tablefootnote}              % footnotes within tables
\usepackage[sc,hang]{caption}           % customize captions of tables and figures
\usepackage{subcaption}                 % subfigures and subtables
\usepackage[charter]{mathdesign}        % font choice
\usepackage{microtype}                  % better kerning
\usepackage{siunitx}                    % elegant handling of units
\usepackage{pgfplotstable}              % typeset tables intelligently
\usepackage[backend=bibtex]{biblatex}   % bibliography
\usepackage{varioref}                   % good for referencing things 'far away'
\usepackage{hyperref}                   % hyperlinks
\usepackage{cleveref}                   % allows \cref and friends
\usepackage{refcheck}                   % checks if labels have been used remove once the document is completed

% hyperlink setup
\hypersetup{colorlinks=true,
	linkcolor=blue,
citecolor=black,
}

% bibliography settings
\addbibresource{pccbib}

% cleveref settings
\crefname{table}{Table}{Tables}
\Crefname{table}{Table}{Tables}
\crefname{figure}{Figure}{Figures}
\Crefname{figure}{Figure}{Figures}

% graphics path
\graphicspath{{./graphics/}}

% axis style, ticks, etc
\pgfplotsset{every axis/.append style={
                    legend cell align=left,       % otherwise width won't be as intended: http://tex.stackexchange.com/questions/36297/pgfplots-how-can-i-scale-to-text-width
                    }}

% percentage style for tables
\pgfplotstableset{percentstyle/.style={
    preproc/expr={##1*100},
    dec sep align,fixed,fixed zerofill,
postproc cell content/.append code={
            \ifx\\##1\\% check if ##1 is empty
            \else
            \ifnum1=\pgfplotstablepartno
                \pgfkeysalso{@cell content/.add={}{\,\%}}%
            \fi
            \fi
        },
    precision=0,
},
sectionFTPT/.style={
every head row/.style={
        before row={%
        \toprule
        },
        after row=\midrule},
every last row/.style={after row=\bottomrule},
    columns/campus/.style={string type,column name={},column type=l},
    columns/status/.style={string type,column name={},column type=l},
    columns/below100/.style={column name={Below 100 level},column type=r},
    columns/b100percent/.style={column name={\%},percentstyle},
    columns/above100/.style={column name={Above 100 level},column type=r},
    columns/a100percent/.style={column name={\%},percentstyle},
    columns/totpercent/.style={column name={\%},percentstyle},
    columns/total/.style={column name={Total},column type=r},
}
}

% empty column type- very useful for big tables that ignore columns
\newcolumntype{H}{>{\setbox0=\hbox\bgroup}c<{\egroup}@{}}



% glossaries settings- load after hyperref: http://tex.stackexchange.com/questions/1863/which-packages-should-be-loaded-after-hyperref-instead-of-before
%\usepackage[nonumberlist,section=chapter]{glossaries}
\usepackage[section=chapter,toc]{glossaries}
% make the links black
\renewcommand*{\glstextformat}[1]{\textcolor{black}{#1}} 
% basic vocab
\newglossaryentry{ADA}{name=ADA,description={Americans with Disabilities Act}}
\newglossaryentry{ALC}{name=ALC,description={Alternative Learning Center. The Alternative Learning Center was the previous name given to the current Student Learning Center}}
\newglossaryentry{ALEKS}{name=ALEKS,description={Publisher owned software.}}
\newglossaryentry{AMP}{name=AMP,description={Accelerated Mathematics Program}}
\newglossaryentry{AY}{name=AY,description={Academic Year}} 
\newglossaryentry{CIC}{name=CIC,description={Completion Investment Council}} 
\newglossaryentry{CTE}{name=CTE,description={Career Technical Education}} 
\newglossaryentry{OSD}{name=OSD,description={Office of Students with Disabilities}} 
\newglossaryentry{CCOG}{name=CCOG,description={Course Curriculum and Outcome Guide}} 
\newglossaryentry{DL}{name=DL,description={Distance Learning}} 
\newglossaryentry{DOI}{name=DOI,description={Deans Of Instruction}}
\newglossaryentry{F2F}{name=F2F,description={Face-to-face}} 
\newglossaryentry{FT}{name=FT,description={Full-time (usually in reference to faculty)}} 
\newglossaryentry{LAS}{name=LAS,description={Learning Assessment Council}} 
\newglossaryentry{LDC}{name=LDC,description={Lower Division Collegiate}} 
\newglossaryentry{MML}{name=MML,description={MyMathLab-- a commercial, publisher-owned homework management system }}
\newglossaryentry{PT}{name=PT,description={Part-time (usually in reference to faculty)}} 
\newglossaryentry{SAC}{name=SAC,description={Section Area Committee}}
\newglossaryentry{WRC}{name=WRC,description={Women's Resource Center}}
\makeglossaries

% to do:
%   - tcolorbox around title and toc, or perhaps pretty toc?
%           http://tex.stackexchange.com/questions/35825/pretty-table-of-contents
%   - glossary items, and update glossary entries throughout using perl script
%   - make consistent choice about on-campus, oncampus, on campus, online
%   - make consistent choice about full-time, full time, part-time, part time
%   - make consistent choice about face 2 face or face-to-face
%   - check that all sections in the appendix are referenced in the body 
%       (use refcheck package to check the output and grep the log file)
%   - address all fixthis issues (check output and .log file)
%   - check for undefined references, multiply defined labels- grep log file
%   - give headings to paragraphs when appropriate using \paragraph{}
%   - do we need the bookmark package? are we getting bookmarks in the sidepane?

% Define fix command
% 	- it puts a comment in the margin
% 	- it writes to a file with a list of things that need fixing
\newcommand{\fixthis}[1]
{%
	\marginpar{\huge \color{red} \framebox{FIX}}%
	\typeout{FIXTHIS: p\thepage : #1^^J}%
}

%Title page info
\title{A Review of the Mathematics Program/Discipline at Portland Community College}
\date{Fall 2008 -- Fall 2013}
\titlepic{\includegraphics[width=\textwidth]{50th_mathematicsproof}}

% from the titlesec package
%\titleformat{ command }
%             [ shape ]
%             { format }{ label }{ sep }{ before-code }[ after-code ]
% custom chapter
\titleformat{\chapter}
{\normalfont\Large\filleft\bf}                          % format applied to label+text
{}                                                      % label
{1pc}                                                   % horizontal separation between label and title body
{\resizebox{2cm}{!}{\color{gray!80}\thechapter}\\\Huge} % before the title body
[]                                                      % after the title body

% \chapter*
\titleformat{name=\chapter,numberless}
{\normalfont\huge\bfseries}{}{-20pt}{\Huge}

% custom section
\titleformat{\section}
{\itshape}
{\llap{\vbox to 5pt{\hbox{\resizebox{1cm}{!}{\normalfont\thesection.}}}\hskip 9pt}}
{0pt}
{}

% custom paragraph heading
\titleformat{\paragraph}[leftmargin]
{\normalfont
\scshape\filleft}
{}
{0pt}
{}

% spacing around headings
% From the titlesec package
% \titlespacing{command}{left spacing}{before spacing}{after spacing}[right]
% spacing: how to read {12pt plus 4pt minus 2pt}
%           12pt is what we would like the spacing to be
%           plus 4pt means that TeX can stretch it by at most 4pt
%           minus 2pt means that TeX can shrink it by at most 2pt
%       This is one example of the concept of, 'glue', in TeX
\titlespacing{\chapter}{0pt}{0pt}{0.1cm}
\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{5pt plus 2pt minus 2pt}
\titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{-6pt plus 2pt minus 2pt}
\titlespacing{\paragraph}{4pc}{1.5ex plus .1ex minus .2ex}{1pc}

% secnumdepth dictates which headings get enumerated- setting it 
% to 1 means that chapters and sections get enumerated, but 
% no headings below them will (such as subsection, subsubsection, paragraph, etc)
\setcounter{secnumdepth}{1}

% headers and footers
\fancyhf{} % delete current header and footer
\fancyhead[LE,RO]{\bfseries\thepage}
\fancyhead[LO,RE]{\leftmark}
\pagestyle{fancy}

% remove the word Chapter from the header
\def\chaptermark#1{\markboth{\textsc{\thechapter. \  #1}}{}}

%%% make refcheck and cleveref play nicely together: 
% http://tex.stackexchange.com/questions/87610/making-refcheck-work-with-cleveref
\makeatletter
\newcommand{\refcheckize}[1]{%
  \expandafter\let\csname @@\string#1\endcsname#1%
  \expandafter\DeclareRobustCommand\csname relax\string#1\endcsname[1]{%
    \csname @@\string#1\endcsname{##1}\wrtusdrf{##1}}%
  \expandafter\let\expandafter#1\csname relax\string#1\endcsname
}
\makeatother
% Now we add the reference commands we want refcheck to be aware of
\refcheckize{\vref}
\refcheckize{\cref}
\refcheckize{\Cref}
\refcheckize{\cpageref}
%%%

% wide page for side by side figures, tables, etc
\newlength{\offsetpage}
\setlength{\offsetpage}{3.0cm}
\newenvironment{widepage}{\begin{adjustwidth}{-\offsetpage}{-.5\offsetpage}%
                            \addtolength{\textwidth}{2\offsetpage}}%
                         {\end{adjustwidth}}

% renew the quote environment to make it italic
\let\oldquote\quote
\let\oldendquote\endquote
\renewenvironment{quote}{\oldquote \itshape}{\oldendquote}


%\includeonly{FacilitiesAndSupport}
%\includeonly{NeedsOfStudentsAndCommunity,appendices/enrollmentSummaries}
%\includeonly{appendices/dlSuccessfulCompletion}
%\includeonly{OtherCurricularIssues}

\begin{document}

% The following lines should be uncommented in the final (production) version
%\maketitle
\tableofcontents
%\printglossary

%= == == == == == == == == == == =
% main chapters
%= == == == == == == == == == == =
\renewcommand{\thesection}{\Alph{section}}
% need section 1
% need section 2
\include{OtherCurricularIssues}
\include{NeedsOfStudentsAndCommunity}
% need section 5
\include{FacilitiesAndSupport}

%= == == == == == == == == == == =
% bibliography
%= == == == == == == == == == == =
\printbibliography[heading=bibintoc]

%= == == == == == == == == == == =
% appendices
%= == == == == == == == == == == =
\appendix
% add the word Appendix to the header
\def\chaptermark#1{\markboth{\textsc{Appendix \thechapter. \  #1}}{}}
% custom section
\titleformat{\section}
{\Large\bfseries}
{\llap{\thesection\hskip.5cm}}
{0pt}
{}
\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{-5pt plus 2pt minus 2pt}

\renewcommand{\thesection}{\arabic{section}}
% start a partial tableofcontents for the appendix
%\chapter*{Appendices}
\addcontentsline{toc}{chapter}{Appendices}
\startcontents[appendixtoc]
%\printcontents[appendixtoc]{}{0}{}
\include{appendices/changeinALCcourses}
\include{appendices/coreOutcomesMapping}
\include{appendices/courseScheduling}
\include{appendices/dlSuccessfulCompletion}
\include{appendices/resourcesurvey}
\include{appendices/onlineHwStudy}
\include{appendices/accessibilitysummary}
\include{appendices/ALEKSpilot}
\include{appendices/enrollmentSummaries}
\include{appendices/sectionsTaughtPTFT}
\include{appendices/facultyDegrees}
\include{appendices/ampData}
\include{appendices/effectivenessALC}
\include{appendices/socialJustice}
\include{appendices/classSize}
\include{appendices/demographicData}
\printbibliography

\end{document}
